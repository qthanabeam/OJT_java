sap.ui.define(["ojt/employ/controller/BaseController","sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,n,o,r,a){"use strict";return e.extend("ojt.employ.controller.Leave",{onInit:function(){var e=this.getOwnerComponent().getRouter();e.getRoute("leave").attachPatternMatched(this._onRouteMatched,this);var t=new o({startDate:null,endDate:null,reason:""});this.getView().setModel(t,"newLeave");this._employeeId=null},_onRouteMatched:function(e){var t=e.getParameter("arguments").employeeId;console.log("Employee ID from URL:",t);this._employeeId=t;var o=this.getView();o.bindElement({path:"/Employees("+t+")",events:{dataReceived:function(e){var o=e.getParameter("context");if(o){console.log("Binding successful for employee:",t);console.log("Binding context:",o.getObject())}else{console.error("Binding failed: No context returned for employee",t);n.show("Không thể tải thông tin nhân viên")}}.bind(this),dataRequested:function(){console.log("Data requested for employee:",t)}}});var s=this.byId("leaveTable");var i=s.getBinding("items");if(i){var l=new r("employee/ID",a.EQ,t);i.filter([l]);i.refresh();console.log("Applied filter for leave requests: employee/ID =",t)}else{console.error("Table binding not found")}},onNavBack:function(){this.getOwnerComponent().getRouter().navTo("list")},onAddLeaveRequest:function(){var e=this.getView().getModel();var t=this.getView().getModel("newLeave");var o=this._employeeId;if(!o){console.error("Employee ID is missing or invalid");n.show("Lỗi: Không thể xác định ID nhân viên");return}var s=t.getData();if(!s.startDate||!s.endDate){n.show("Vui lòng điền đầy đủ ngày bắt đầu và kết thúc");return}console.log("Creating leave request for employee ID: ",o);console.log("Leave request payload:",{employee:{ID:o},startDate:s.startDate,endDate:s.endDate,status:"Pending",reason:s.reason||""});var i=e.bindList("/LeaveRequests");var l=i.create({employee:{ID:o},startDate:s.startDate,endDate:s.endDate,status:"Pending",reason:s.reason||""});l.created().then(function(){console.log("New Leave Request created: ",l.getObject());n.show("Yêu cầu nghỉ phép đã được tạo");t.setData({startDate:null,endDate:null,reason:""});var e=this.byId("leaveTable");var s=e.getBinding("items");if(s){s.filter([new r("employee/ID",a.EQ,o)]);s.refresh();console.log("Table binding refreshed for employee: "+o)}}.bind(this)).catch(function(e){console.error("Error creating leave request: ",e);n.show("Lỗi khi tạo yêu cầu nghỉ phép: "+(e.message||"Unknown error"))})},onApproveRequest:function(e){var t=e.getSource().getParent().getParent();var o=t.getBindingContext();var r=this.getView().getModel();if(!o){n.show("Không thể xác định yêu cầu nghỉ phép");return}var a=o.getProperty("ID");var s=r.bindContext("/updateLeaveStatus(...)");s.setParameter("leaveID",a);s.setParameter("status","Approved");s.execute().then(function(){n.show("Yêu cầu nghỉ phép đã được phê duyệt");r.refresh()}).catch(function(e){n.show("Lỗi khi phê duyệt yêu cầu nghỉ phép: "+(e.message||"Unknown error"))})},onRejectRequest:function(e){var t=e.getSource().getParent().getParent();var o=t.getBindingContext();var r=this.getView().getModel();if(!o){n.show("Không thể xác định yêu cầu nghỉ phép");return}var a=o.getProperty("ID");var s=r.bindContext("/updateLeaveStatus(...)");s.setParameter("leaveID",a);s.setParameter("status","Rejected");s.execute().then(function(){n.show("Yêu cầu nghỉ phép đã bị từ chối");r.refresh()}).catch(function(e){n.show("Lỗi khi từ chối yêu cầu nghỉ phép: "+(e.message||"Unknown error"))})}})});
//# sourceMappingURL=Leave.controller.js.map